F := FiniteField(2);  
R<x,y>:=PolynomialRing(F,2);
pol := x^27*y^24 
	+ (45*x^27 - 64*x^26 + 56*x^25 - 49*x^24 + 42*x^23 - 36*x^22 + 30*x^21 - 25*x^20 + 20*x^19 - 16*x^18 + 12*x^17 - 9*x^16 + 6*x^15 - 4*x^14 + 2*x^13 - x^12)*y^23 
	+ (x^40 - 4*x^39 + 12*x^38 - 28*x^37 + 58*x^36 - 108*x^35 + 188*x^34 - 308*x^33 + 483*x^32 - 728*x^31 + 1064*x^30 - 1512*x^29 + 2100*x^28 - 1866*x^27 + 936*x^26 - 224*x^25 - 91*x^24 + 147*x^23 - 70*x^22 - 68*x^21 + 198*x^20 - 298*x^19 + 340*x^18 - 336*x^17 + 283*x^16 - 211*x^15 + 126*x^14 - 60*x^13 + 12*x^12)*y^22 
	+ (30*x^40 - 145*x^39 + 450*x^38 - 1068*x^37 + 2156*x^36 - 3855*x^35 + 6324*x^34 - 9712*x^33 + 14268*x^32 - 20406*x^31 + 28980*x^30 - 41544*x^29 + 60912*x^28 - 77556*x^27 + 78192*x^26 - 64080*x^25 + 44339*x^24 - 25473*x^23 + 10170*x^22 + 744*x^21 - 7530*x^20 + 10731*x^19 - 11196*x^18 + 9696*x^17 - 7179*x^16 + 4390*x^15 - 2100*x^14 + 624*x^13 - 78*x^12)*y^21 
	+ (435*x^40 - 2490*x^39 + 8320*x^38 - 20558*x^37 + 41659*x^36 - 72720*x^35 + 112860*x^34 - 158856*x^33 + 206578*x^32 - 254084*x^31 + 309040*x^30 - 401740*x^29 + 609746*x^28 - 951061*x^27 + 1294648*x^26 - 1489160*x^25 + 1493875*x^24 - 1358165*x^23 + 1150642*x^22 - 924074*x^21 + 708455*x^20 - 517465*x^19 + 355400*x^18 - 224148*x^17 + 124584*x^16 - 57345*x^15 + 19390*x^14 - 4004*x^13 + 364*x^12)*y^20 
	+ (4060*x^40 - 27115*x^39 + 99870*x^38 - 264202*x^37 + 558541*x^36 - 994500*x^35 + 1533500*x^34 - 2068496*x^33 + 2421174*x^32 - 2362351*x^31 + 1684990*x^30 - 390180*x^29 - 859558*x^28 + 930706*x^27 + 594972*x^26 - 2911360*x^25 + 4828945*x^24 - 5691444*x^23 + 5525412*x^22 - 4726446*x^21 + 3728505*x^20 - 2826170*x^19 + 2131664*x^18 - 1623204*x^17 + 1221376*x^16 - 865795*x^15 + 547170*x^14 - 298894*x^13 + 142885*x^12 - 62055*x^11 + 25100*x^10 - 9440*x^9 + 3252*x^8 - 1005*x^7 + 270*x^6 - 60*x^5 + 10*x^4 - x^3)*y^19 
	+ (27405*x^40 - 211120*x^39 + 868260*x^38 - 2518110*x^37 + 5765163*x^36 - 11056746*x^35 + 18392724*x^34 - 27068096*x^33 + 35497662*x^32 - 41113446*x^31 + 40419568*x^30 - 29748882*x^29 + 8741661*x^28 + 15932566*x^27 - 33667356*x^26 + 38177496*x^25 - 31348499*x^24 + 19804281*x^23 - 9622482*x^22 + 3705532*x^21 - 1975314*x^20 + 2751381*x^19 - 4110432*x^18 + 4739340*x^17 - 4253004*x^16 + 3027752*x^15 - 1740948*x^14 + 842910*x^13 - 370407*x^12 + 159363*x^11 - 68592*x^10 + 28588*x^9 - 11022*x^8 + 3762*x^7 - 1084*x^6 + 246*x^5 - 39*x^4 + 3*x^3)*y^18 
	+ (x^47 - 14*x^46 + 112*x^45 - 658*x^44 + 3143*x^43 - 12880*x^42 + 46816*x^41 - 11846*x^40 - 786065*x^39 + 4470578*x^38 - 15195034*x^37 + 38784869*x^36 - 81160498*x^35 + 146057324*x^34 - 232965616*x^33 + 335866095*x^32 - 442256931*x^31 + 531077358*x^30 - 569907484*x^29 + 523642826*x^28 - 383147512*x^27 + 186967892*x^26 - 3204568*x^25 - 113898187*x^24 + 150437259*x^23 - 126839214*x^22 + 76092708*x^21 - 25963762*x^20 - 8238520*x^19 + 23079176*x^18 - 23027916*x^17 + 15742992*x^16 - 7968546*x^15 + 3027124*x^14 - 916010*x^13 + 302413*x^12 - 164048*x^11 + 107896*x^10 - 61880*x^9 + 28927*x^8 - 10886*x^7 + 3208*x^6 - 696*x^5 + 96*x^4 - 6*x^3)*y^17 
	+ (18*x^47 - 256*x^46 + 2050*x^45 - 11979*x^44 + 56747*x^43 - 230624*x^42 + 833328*x^41 - 2150265*x^40 + 2447322*x^39 + 6803784*x^38 - 46454614*x^37 + 151031863*x^36 - 361941390*x^35 + 713776900*x^34 - 1220556568*x^33 + 1869642018*x^32 - 2624387419*x^31 + 3423238990*x^30 - 4153799862*x^29 + 4623773297*x^28 - 4613408507*x^27 + 4024448568*x^26 - 2987677060*x^25 + 1804447576*x^24 - 776742255*x^23 + 74892786*x^22 + 283723746*x^21 - 379282635*x^20 + 322059111*x^19 - 208368528*x^18 + 102195180*x^17 - 32791740*x^16 + 1314420*x^15 + 6123456*x^14 - 4339380*x^13 + 1612092*x^12 - 208503*x^11 - 175460*x^10 + 163676*x^9 - 83781*x^8 + 30921*x^7 - 8454*x^6 + 1620*x^5 - 190*x^4 + 10*x^3)*y^16 
	+ (153*x^47 - 2214*x^46 + 17770*x^45 - 103275*x^44 + 484581*x^43 - 1948924*x^42 + 6985272*x^41 - 20909685*x^40 + 47589750*x^39 - 71858448*x^38 + 30062376*x^37 + 211364042*x^36 - 841251015*x^35 + 2042667900*x^34 - 3911372892*x^33 + 6407477739*x^32 - 9385761591*x^31 + 12686680950*x^30 - 16157525490*x^29 + 19483059285*x^28 - 21995400939*x^27 + 22832034012*x^26 - 21462431280*x^25 + 18107094050*x^24 - 13646031837*x^23 + 9136964850*x^22 - 5360203236*x^21 + 2649605310*x^20 - 975785265*x^19 + 116908816*x^18 + 202548600*x^17 - 232383645*x^16 + 156155880*x^15 - 76467240*x^14 + 27588366*x^13 - 6315399*x^12 - 127827*x^11 + 1043460*x^10 - 659760*x^9 + 276165*x^8 - 86613*x^7 + 20234*x^6 - 3300*x^5 + 330*x^4 - 15*x^3)*y^15 
	+ (816*x^47 - 12036*x^46 + 96990*x^45 - 560795*x^44 + 2602876*x^43 - 10331684*x^42 + 36611728*x^41 - 113848730*x^40 + 296635555*x^39 - 622617930*x^38 + 1008353160*x^37 - 1122223842*x^36 + 349913790*x^35 + 2039364000*x^34 - 6540755400*x^33 + 13062725829*x^32 - 20864331819*x^31 + 28972532250*x^30 - 36849131730*x^29 + 44580385719*x^28 - 52145361477*x^27 + 58482624548*x^26 - 61593542920*x^25 + 59819592980*x^24 - 53082780398*x^23 + 42983880436*x^22 - 31858856534*x^21 + 21690606775*x^20 - 13567092710*x^19 + 7740600304*x^18 - 3958108384*x^17 + 1757924570*x^16 - 641282455*x^15 + 167412550*x^14 - 11754800*x^13 - 19010666*x^12 + 15006182*x^11 - 7421260*x^10 + 2866280*x^9 - 900635*x^8 + 227395*x^7 - 44114*x^6 + 6090*x^5 - 525*x^4 + 21*x^3)*y^14 
	+ (3060*x^47 - 46104*x^46 + 373830*x^45 - 2152215*x^44 + 9870009*x^43 - 38537556*x^42 + 134374896*x^41 - 421185361*x^40 + 1156255414*x^39 - 2704055628*x^38 + 5293566688*x^37 - 8551064824*x^36 + 11082723534*x^35 - 10570400216*x^34 + 4669854464*x^33 + 7531144869*x^32 - 24337000907*x^31 + 41675592914*x^30 - 55262891406*x^29 + 63463888123*x^28 - 68204160271*x^27 + 72664625304*x^26 - 77890625448*x^25 + 81717039657*x^24 - 80828984961*x^23 + 73621697462*x^22 - 61296513656*x^21 + 46806234720*x^20 - 33053986720*x^19 + 21764705896*x^18 - 13407711324*x^17 + 7696922176*x^16 - 4077691279*x^15 + 1971677526*x^14 - 862902922*x^13 + 340393507*x^12 - 120828597*x^11 + 38466880*x^10 - 10869640*x^9 + 2665482*x^8 - 546084*x^7 + 88368*x^6 - 10416*x^5 + 784*x^4 - 28*x^3)*y^13 
	+ (8568*x^47 - 132192*x^46 + 1081608*x^45 - 6210882*x^44 + 28127673*x^43 - 107634512*x^42 + 366807540*x^41 - 1139778231*x^40 + 3195918407*x^39 - 7898865942*x^38 + 16906331268*x^37 - 31063948744*x^36 + 48756566991*x^35 - 64824292572*x^34 + 71407164636*x^33 - 61243977651*x^32 + 32332466577*x^31 + 8783778678*x^30 - 48373387134*x^29 + 72488205561*x^28 - 75499000815*x^27 + 63225258780*x^26 - 47675028876*x^25 + 38123286154*x^24 - 36126376185*x^23 + 37341294690*x^22 - 36742245774*x^21 + 32289811695*x^20 - 25104316680*x^19 + 17510293884*x^18 - 11215342800*x^17 + 6747332742*x^16 - 3856444220*x^15 + 2083451556*x^14 - 1047252630*x^13 + 481973941*x^12 - 201148212*x^11 + 75928440*x^10 - 25950728*x^9 + 8024472*x^8 - 2226906*x^7 + 544852*x^6 - 114576*x^5 + 20112*x^4 - 2852*x^3 + 312*x^2 - 24*x + 1)*y^12 
	+ (18564*x^47 - 294168*x^46 + 2437800*x^45 - 14004396*x^44 + 62687007*x^43 - 234363816*x^42 + 773910536*x^41 - 2344890085*x^40 + 6564730715*x^39 - 16695458642*x^38 + 37782443104*x^37 - 75109248074*x^36 + 130491707620*x^35 - 197813076260*x^34 + 260942803924*x^33 - 297005950338*x^32 + 285500590599*x^31 - 220054872870*x^30 + 116140677744*x^29 - 7545121788*x^28 - 69649378221*x^27 + 96370364912*x^26 - 79111518520*x^25 + 41747193602*x^24 - 8460027079*x^23 - 8742944302*x^22 + 11144450324*x^21 - 6454365460*x^20 + 1492515680*x^19 + 945304916*x^18 - 1228818356*x^17 + 692741413*x^16 - 217682690*x^15 + 14808528*x^14 + 21315408*x^13 - 10487742*x^12 + 1454105*x^11 + 648320*x^10 - 355432*x^9 + 36562*x^8 + 28840*x^7 - 15176*x^6 + 3640*x^5 - 476*x^4 + 28*x^3)*y^11 
	+ (31824*x^47 - 519792*x^46 + 4383960*x^45 - 25321500*x^44 + 112452960*x^43 - 410715444*x^42 + 1303885764*x^41 - 3778025940*x^40 + 10273849605*x^39 - 26158778622*x^38 + 61102092498*x^37 - 128365280601*x^36 + 239852525985*x^35 - 397129580640*x^34 + 582560528760*x^33 - 756947792331*x^32 + 868229539966*x^31 - 870678832120*x^30 + 747732848010*x^29 - 526210130829*x^28 + 269986817661*x^27 - 52104695412*x^26 - 79229798500*x^25 + 118717285555*x^24 - 96047596422*x^23 + 51647605564*x^22 - 14826227074*x^21 - 3984610215*x^20 + 8189270060*x^19 - 5680110656*x^18 + 2349156672*x^17 - 436880263*x^16 - 158184365*x^15 + 163225290*x^14 - 63038620*x^13 + 8878084*x^12 + 3714765*x^11 - 2589420*x^10 + 664980*x^9 - 15240*x^8 - 49672*x^7 + 19096*x^6 - 3780*x^5 + 420*x^4 - 21*x^3)*y^10 
	+ (x^48 + 43728*x^47 - 739428*x^46 + 6385910*x^45 - 37363545*x^44 + 165974022*x^43 - 596181360*x^42 + 1819079496*x^41 - 4957213545*x^40 + 12640046245*x^39 - 30905259546*x^38 + 71971480722*x^37 - 155869034179*x^36 + 307199608875*x^35 - 544496505840*x^34 + 864737747436*x^33 - 1231120786698*x^32 + 1573159505544*x^31 - 1803331558600*x^30 + 1847050083570*x^29 - 1675307093937*x^28 + 1323777516230*x^27 - 883997257848*x^26 + 466480171080*x^25 - 155136525100*x^24 - 20439721284*x^23 + 81645091260*x^22 - 75225300906*x^21 + 45430649055*x^20 - 18845151405*x^19 + 3963012104*x^18 + 1277683656*x^17 - 1736260272*x^16 + 924396505*x^15 - 287308650*x^14 + 29410302*x^13 + 22048727*x^12 - 14460810*x^11 + 4438020*x^10 - 604240*x^9 - 107349*x^8 + 81090*x^7 - 22336*x^6 + 3630*x^5 - 345*x^4 + 15*x^3)*y^9 
	+ (9*x^48 + 48349*x^47 - 851342*x^46 + 7583440*x^45 - 45377350*x^44 + 204157022*x^43 - 732476320*x^42 + 2181202096*x^41 - 5607321503*x^40 + 13049897347*x^39 - 28911186838*x^38 + 62886556490*x^37 - 133622146795*x^36 + 269540042581*x^35 - 502052857904*x^34 + 849914153164*x^33 - 1300684284538*x^32 + 1800121513754*x^31 - 2257834893772*x^30 + 2569918045768*x^29 - 2652139451486*x^28 + 2472354870712*x^27 - 2067710391236*x^26 + 1534846433716*x^25 - 994006375019*x^24 + 544546066338*x^23 - 235371322836*x^22 + 62848873428*x^21 + 9486661872*x^20 - 25583231523*x^19 + 19465095876*x^18 - 9900137948*x^17 + 3542709055*x^16 - 719628272*x^15 - 89811212*x^14 + 154505362*x^13 - 75603911*x^12 + 22646439*x^11 - 3794556*x^10 - 149016*x^9 + 322406*x^8 - 112303*x^7 + 23366*x^6 - 3160*x^5 + 260*x^4 - 10*x^3)*y^8 
	+ (36*x^48 + 42669*x^47 - 789358*x^46 + 7310770*x^45 - 45194895*x^44 + 208868089*x^43 - 764023252*x^42 + 2286822312*x^41 - 5744139907*x^40 + 12459634390*x^39 - 24323698872*x^38 + 45208736038*x^37 - 84271996705*x^36 + 159650838612*x^35 - 298174717472*x^34 + 526812190724*x^33 - 856897183728*x^32 + 1269230839506*x^31 - 1709896703844*x^30 + 2100708324756*x^29 - 2360307816350*x^28 + 2428361803490*x^27 - 2285477476884*x^26 + 1961754953296*x^25 - 1528480258882*x^24 + 1074083490945*x^23 - 674780360442*x^22 + 374024084304*x^21 - 178833736998*x^20 + 70456559200*x^19 - 20191241980*x^18 + 1896210396*x^17 + 2299455876*x^16 - 1957437936*x^15 + 965953692*x^14 - 344507542*x^13 + 88105633*x^12 - 12722778*x^11 - 1292620*x^10 + 1510432*x^9 - 543105*x^8 + 127184*x^7 - 21044*x^6 + 2412*x^5 - 174*x^4 + 6*x^3)*y^7 
	+ (84*x^48 + 29268*x^47 - 578412*x^46 + 5621590*x^45 - 36237735*x^44 + 174098115*x^43 - 660939336*x^42 + 2046946788*x^41 - 5269011255*x^40 + 11422715163*x^39 - 21152923974*x^38 + 34249557564*x^37 - 50704698980*x^36 + 73887961860*x^35 - 114058838280*x^34 + 188093143732*x^33 - 312488210874*x^32 + 492083904072*x^31 - 711883715160*x^30 + 938248931052*x^29 - 1129021731054*x^28 + 1246520329299*x^27 - 1267668526032*x^26 + 1189262535180*x^25 - 1028383324439*x^24 + 817662251346*x^23 - 595791363444*x^22 + 396340194330*x^21 - 239662595565*x^20 + 131011649973*x^19 - 64253657052*x^18 + 27951950916*x^17 - 10587592176*x^16 + 3374895980*x^15 - 837424824*x^14 + 120900336*x^13 + 17623248*x^12 - 20577960*x^11 + 8854920*x^10 - 2667956*x^9 + 616770*x^8 - 110841*x^7 + 15170*x^6 - 1500*x^5 + 96*x^4 - 3*x^3)*y^6 
	+ (126*x^48 + 14700*x^47 - 322368*x^46 + 3332010*x^45 - 22592765*x^44 + 113772406*x^43 - 452954456*x^42 + 1475519112*x^41 - 4008958590*x^40 + 9180296175*x^39 - 17811576074*x^38 + 29339500534*x^37 - 41057774705*x^36 + 48991133775*x^35 - 50881203960*x^34 + 49568986860*x^33 - 53485325763*x^32 + 72419419593*x^31 - 110829370770*x^30 + 163799047930*x^29 - 218941653641*x^28 + 262580498140*x^27 - 285453083828*x^26 + 284726112880*x^25 - 262813873280*x^24 + 225300571260*x^23 - 179302926852*x^22 + 132124314390*x^21 - 89855516635*x^20 + 56230560740*x^19 - 32293527100*x^18 + 16976090452*x^17 - 8143836659*x^16 + 3551802250*x^15 - 1401589320*x^14 + 497461854*x^13 - 157646205*x^12 + 44204280*x^11 - 10843680*x^10 + 2293440*x^9 - 410192*x^8 + 60400*x^7 - 7040*x^6 + 610*x^5 - 35*x^4 + x^3)*y^5 
	+ (126*x^48 + 4662*x^47 - 127092*x^46 + 1436520*x^45 - 10372950*x^44 + 55132646*x^43 - 231274292*x^42 + 796148268*x^41 - 2300395230*x^40 + 5651507940*x^39 - 11887546692*x^38 + 21466889486*x^37 - 33244821125*x^36 + 43898261205*x^35 - 48770540320*x^34 + 44307016180*x^33 - 30719510775*x^32 + 12681946947*x^31 + 3004582770*x^30 - 11342844990*x^29 + 11724487123*x^28 - 7354752400*x^27 + 2410710708*x^26 + 559959360*x^25 - 1299348600*x^24 + 838527186*x^23 - 215321432*x^22 - 115154560*x^21 + 170237670*x^20 - 112101675*x^19 + 50726556*x^18 - 17089788*x^17 + 4345229*x^16 - 818495*x^15 + 108570*x^14 - 9100*x^13 + 364*x^12)*y^4 
	+ (84*x^48 + 414*x^47 - 29988*x^46 + 404460*x^45 - 3206610*x^44 + 18229212*x^43 - 81004012*x^42 + 294886680*x^41 - 904066917*x^40 + 2373236558*x^39 - 5387599572*x^38 + 10638463704*x^37 - 18325621504*x^36 + 27551433906*x^35 - 36073671984*x^34 + 40895738256*x^33 - 39675370329*x^32 + 32182848876*x^31 - 20728596112*x^30 + 9080352918*x^29 - 523789143*x^28 - 3614743189*x^27 + 4091926956*x^26 - 2718178176*x^25 + 1121226719*x^24 - 105244224*x^23 - 269784108*x^22 + 273696974*x^21 - 165739311*x^20 + 74390349*x^19 - 26066572*x^18 + 7201248*x^17 - 1550919*x^16 + 252650*x^15 - 29400*x^14 + 2184*x^13 - 78*x^12)*y^3 
	+ (36*x^48 - 348*x^47 - 1680*x^46 + 55524*x^45 - 550746*x^44 + 3515706*x^43 - 16898148*x^42 + 65549728*x^41 - 213189353*x^40 + 594635197*x^39 - 1442198294*x^38 + 3067644904*x^37 - 5753229914*x^36 + 9544528886*x^35 - 14029911364*x^34 + 18276630716*x^33 - 21068769749*x^32 + 21413590381*x^31 - 19054828946*x^30 + 14656212576*x^29 - 9505474770*x^28 + 4914917790*x^27 - 1691912552*x^26 - 36246092*x^25 + 634538134*x^24 - 621345313*x^23 + 407738234*x^22 - 209386984*x^21 + 87838704*x^20 - 30466038*x^19 + 8718036*x^18 - 2033600*x^17 + 378166*x^16 - 54053*x^15 + 5586*x^14 - 372*x^13 + 12*x^12)*y^2 
	+ (9*x^48 - 153*x^47 + 1050*x^46 - 2310*x^45 - 19593*x^44 + 234927*x^43 - 1419840*x^42 + 6243840*x^41 - 22117330*x^40 + 66123070*x^39 - 171149316*x^38 + 389286482*x^37 - 785186945*x^36 + 1412490390*x^35 - 2274947444*x^34 + 3289138748*x^33 - 4276760289*x^32 + 5007066315*x^31 - 5281369770*x^30 + 5018995056*x^29 - 4294931512*x^28 + 3305724571*x^27 - 2284388400*x^26 + 1413770320*x^25 - 781005784*x^24 + 383481264*x^23 - 166455336*x^22 + 63437010*x^21 - 21043005*x^20 + 6008384*x^19 - 1455404*x^18 + 293316*x^17 - 47870*x^16 + 6080*x^15 - 564*x^14 + 34*x^13 - x^12)*y
	+ x^27*(x-1)^21;
A2<u,v> := AffineSpace(F,2);
X := Curve(A2,pol);
//assert Genus(X) eq 65;
plc:=Places(X,1);
load "gl2data.m";
N:=51;
assert GL2PointCount(GL2Borel1(N),2) eq GL2RationalCuspCount(GL2Borel1(N),2);

time Cl, CltoDiv, DivtoCl := ClassGroup(X); // takes a bit more than one minute
bpt := DivtoCl(Divisor(plc[1]));
G := sub<Cl | [DivtoCl(Divisor(plc[i])) - bpt : i in [2..#plc]]>;
G;
Valuation(#G, 2);


load "gl2data.m";
N:=51;
localtest := procedure(N,p)
GL2PointCount(GL2Borel1(N),p);
GL2PointCount(GL2Borel1(N),p^2)-GL2PointCount(GL2Borel1(N),p);
GL2PointCount(GL2Borel1(N),p^3)-GL2PointCount(GL2Borel1(N),p);
GL2PointCount(GL2Borel1(N),p^4)-GL2PointCount(GL2Borel1(N),p^2);
end procedure;




%%%%%%%%%%%%%%%%%%%%% sage %%%%%%%%%%%%%%%%%5555

G=GammaH(51,[35])
cuspidal_rational_subgroup_mod_rational_cuspidal_subgroup(G)
rational_cuspidal_classgroup(G).invariants() 

//()
//(2, 8, 584, 554543040)

G=GammaH(51,[16])
cuspidal_rational_subgroup_mod_rational_cuspidal_subgroup(G)
rational_cuspidal_classgroup(G).invariants() 
//()
//(2, 8, 584, 554543040)